export const ue5 = (
  key: string,
  json?: string | object,
  cback?: CveCallback,
  timeout?: number
) => {
  if (typeof window.ue.interface !== 'object') {
    window.ue.interface = {}
  }
  const base = '10000000-1000-4000-8000-100000000000'
  const id = base.replace(/[018]/g, (str) => {
    const t = Number(str)
    const random = crypto.getRandomValues(new Uint8Array(1))
    const result = t ^ (random[0] & (15 >> (t / 4)))
    return result.toString(16)
  })
  if (cback) {
    window.ue.interface[id] = cback
  }
  const delay = 1e3 * Math.max(2, timeout ?? 0)
  setTimeout(() => {
    delete window.ue.interface[id]
  }, delay)
  const data = 'string' !== typeof json ? JSON.stringify(json) : ''
  window.ue['$receive'].asyn(key, data, id)
}

export default ue5
