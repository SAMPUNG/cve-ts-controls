/// <reference types="./controls.d.ts" />

/** Actor 控制 */
export class ActorControl extends CveControl {
  /** 显示指定 Tag 的 Actor */
  showByTag(
    tag: string,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定 Tag 的 Actor */
  hideByTag(
    ttag: string,
    callback?: CveCallback
  ): Promise<CveResponse>
}

/** 云渲染控制 */
export class CveControl {
  /** 和云端交互的超时阈值，默认为 15 秒 */
  timeoutSpan: number

  /** 执行自定义指令。通常该指令和数据由虚幻引擎开发人员定义。 */
  executeCustomCommand(
    Command: string,
    Data: string | undefined,
    callback?: CveCallback
  ): Promise<ResponseData>
  /** 执行虚幻引擎指令。该指令为虚幻引擎内置的控制台指令。 */
  executeUeCommand(command: string): Promise<ResponseData>
  getResponse(
    uid: string,
    callback?: CveCallback
  ): Promise<ResponseData>
  sendCommand(
    descriptor: UIDescriptor,
    callback?: CveCallback
  ): Promise<ResponseData>
}

/** 镜头控制 */
export class CameraControl extends CveControl {
  /** 飞到指定的位置 */
  flyTo(
    position: CameraData,
    /** 飞行时间（s） */
    duration: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 获取当前位置 */
  getPosition(callback?: CveCallback): Promise<CveResponse>
}
export interface CameraData {
  ArmLength: number
  Duration?: number
  Location: [x: number, y: number, z: number]
  Rotation: [roll: number, pitch: number, yaw: number]
}

/** 要素数据类 */
export class FeatureData {
  declare ID: string
  declare Name: string
  declare Params: unknown
  declare Style: string
  declare Tag: string

  constructor(
    style: string,
    id: string,
    name: string,
    tag: string,
    params: unknown
  )
}

/** 测量控制 */
export class MeasureControl extends CveControl {
  /** 开始测量 */
  startMeasure(
    type: MeasureType,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 取消测量 */
  cancelMeasure(callback?: CveCallback): Promise<CveResponse>
  /** 清除测量结果*/
  clearMeasureResults(
    callback?: CveCallback
  ): Promise<CveResponse>
}
/** 测量类型 */
export type MeasureType = 'Area' | 'Distance' | 'Height'

/** Point 控制 */
export class PointControl extends CveControl {
  /** 检查指定的 Point 是否已存在 */
  checkExistance(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 生成 Point */
  create(
    pointDataArray: PointData<PointStyle>,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 删除指定的 Point */
  delete(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定的 Point */
  hide(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 选择指定的 Point，注意同时只能选中一个 */
  pick(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Point */
  show(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 取消选择的 Point */
  unselect(callback?: CveCallback): Promise<CveResponse>
}

/** Polygon 控制 */
export class PolygonControl extends CveControl {
  /** 检查指定的 Polygon 是否已存在 */
  checkExistance(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 生成 Polygon */
  create(
    pointDataArray: PolygonData<PolygonStyle>,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 删除指定的 Polygon */
  delete(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定的 Polygon */
  hide(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 选择指定的 Polygon */
  pick(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Polygon */
  show(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 取消选择的 Polygon */
  unselect(callback?: CveCallback): Promise<CveResponse>
}

/** Polyline 控制 */
export class PolylineControl extends CveControl {
  /** 检查指定的 Polyline 是否已存在 */
  checkExistance(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 生成 Polyline */
  create(
    pointDataArray: PolylineData<PolylineStyle>,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 删除指定的 Polyline */
  delete(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定的 Polyline */
  hide(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定的 Polyline，可指定隐藏动画和动画持续时间 */
  hideWithAnimateAndDuration(
    params: CveSelector,
    animate: PLAnimate,
    duration: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 隐藏指定的Polyline，可指定隐藏动画和动画速度 */
  hideWithAnimateAndSpeed(
    params: CveSelector,
    animate: PLAnimate,
    speed: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 选择指定的 Polyline */
  pick(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Polyline */
  show(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Polyline，可指定显示动画和动画持续时间 */
  showWithAnimateAndDuration(
    params: CveSelector,
    animate: PLAnimate,
    duration: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Polyline，可指定显示动画和动画速度 */
  showWithAnimateAndSpeed(
    params: CveSelector,
    animate: PLAnimate,
    speed: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 取消选择的 Polyline */
  unselect(callback?: CveCallback): Promise<CveResponse>
}

/** Polymesh 控制 */
export class PolymeshControl extends CveControl {
  /** 隐藏指定的 Polymesh */
  hide(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 选择指定的 Polymesh */
  pick(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示指定的 Polymesh */
  show(
    params: CveSelector,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 取消选择的 Polymesh */
  unselect(callback?: CveCallback): Promise<CveResponse>
}

/** 场景控制 */
export class SceneControl extends CveControl {
  /** 重置当前场景视角 */
  resetView(callback?: CveCallback): Promise<CveResponse>
  /** 切换自定义场景 */
  switchToCustomScene(
    /** 场景名称 */
    sceneName: string,
    callback?: CveCallback
  ): Promise<CveResponse>
}

/** 过场控制 */
export class SequenceControl extends CveControl {
  /** 暂停 */
  pause(
    /** 是否锁定相机 */
    isLockCamera: boolean,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 播放 */
  play(
    /** Sequence 名称 */
    sequenceName: string,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 停止播放 */
  stop(callback?: CveCallback): Promise<CveResponse>
}

/** 系统控制 */
export class SystemControl extends CveControl {
  /** 开始连接云渲染 */
  start(
    /** URL, 云渲染实例地址 */
    url: string,
    /** 云渲染实例所在的div容器 */
    container: HTMLDivElement
  ): void
  /** 结束连接云渲染 */
  stop(): void
  /** 设置云渲染实例分辨率 */
  setResolution(
    width: number,
    height: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 设置云渲染实例帧率上限 */
  setFramerateCap(
    /** 帧率 */
    rate: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 设置云渲染实例带宽上限 */
  setBandwidthCap(
    /** 带宽（Mb） */
    bandwidth: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 设置云渲染实例流送质量偏好 */
  setDegradationPreference(
    degradationPreference: RTCDegradationPreference,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 重设页面渲染器尺寸 */
  resetPlayerSize(): void
  /** 重启云渲染实例当前关卡 */
  restartLevel(callback?: CveCallback): Promise<CveResponse>
  /** 打开云渲染实例指定关卡 */
  openLevel(
    /** 关卡名 */
    levelName: string,
    sceneName: string,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 显示、隐藏云渲染实例的帧率指示 */
  toggleFps(callback?: CveCallback): Promise<CveResponse>
  /** 设置云渲染实例音量大小 */
  setVolume(
    /** 音量，[0.0,1.0] */
    volume: number,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 设置云渲染实例关闭声音 */
  mute(callback?: CveCallback): Promise<CveResponse>
  /** 设置云渲染实例打开声音 */
  unmute(callback?: CveCallback): Promise<CveResponse>
}

/** 时间控制 */
export class TimeControl extends CveControl {
  /** 禁用实时，渲染场景中的时间不随服务器时间变化。 */
  disableRealtime(callback?: CveCallback): Promise<CveResponse>
  /** 启用实时，渲染场景中的时间随服务器时间变化。 */
  enableRealtime(callback?: CveCallback): Promise<CveResponse>
  /** 设置渲染场景中的时间，设置后渲染场景将禁用实时。 */
  setDateTime(
    dateTime: Date,
    callback?: CveCallback
  ): Promise<CveResponse>
}

/** 天气控制 */
export class WeatherControl extends CveControl {
  /** 根据预设变换天气效果 */
  changeWeatherByPreset(
    /** 变换时间（s） */
    duration: number,
    /** 天气类型 */
    preset: WeatherPreset,
    callback?: CveCallback
  ): Promise<CveResponse>
  /** 根据参数变换天气效果 */
  changeWeatherBySettings(
    /** 变换时间（s） */
    duration: number,
    /** 天气参数 */
    settings: WeatherSettings,
    callback?: CveCallback
  ): Promise<CveResponse>
}
/** 天气类型 */
export type WeatherPreset =
  | 'Sunny'
  | 'Cloudy_Light'
  | 'Cloudy_Medium'
  | 'Cloudy_Heavy'
  | 'Rainy_Light'
  | 'Rainy_Medium'
  | 'Rainy_Heavy'
  | 'Snowy_Light'
  | 'Snowy_Medium'
  | 'Snowy_Heavy'
/** 天气参数 */
export interface WeatherSettings {
  /** 天空中的云覆盖度（1-10） */
  CloudCoverage?: number
  /** 雾量（1-10） */
  Fog?: number
  /** 风强度（1-10） */
  WindIntensity?: number
  /** 雨量（0-10） */
  Rain?: number
  /** 雪量（0-10） */
  Snow?: number
  /** 雷电强度（0-10） */
  ThunderLightning?: number
  /** 沙尘量（0-10） */
  Dust?: number
  /** 场景湿润度（0-1） */
  Wetness?: number
  /** 场景雪覆盖度（0-1） */
  SnowCoverage?: number
  /** 场景沙尘覆盖度（0-1） */
  DustCoverage?: number
}
